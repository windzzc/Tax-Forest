// data
let data = {
  "topicId": 2,
  "topicName": "图论术语",
  "topicUrl": "https://zh.wikipedia.org/wiki/%E5%9B%BE%E8%AE%BA%E6%9C%AF%E8%AF%AD",
  "topicLayer": null,
  "domainId": 1,
  "children": [{
      "facetId": 11,
      "facetName": "摘要",
      "facetLayer": 1,
      "parentFacetId": null,
      "topicId": 2,
      "children": [{
          "assembleId": 458535,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-07 16:17:54",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=458535",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 458545,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:42:03",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=458545",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 458610,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-07 16:18:37",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=458610",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 476881,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-12 21:31:43",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=476881",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 476897,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:47:17",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=476897",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 476955,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-07 16:19:12",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=476955",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 476966,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-07 16:19:18",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=476966",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 476968,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:47:18",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=476968",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 476992,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:47:19",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=476992",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 477004,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-07 16:28:12",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=477004",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 477051,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:47:19",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=477051",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372472,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-10 17:01:49",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372472",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372803,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-11 16:59:34",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372803",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372804,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-11 16:59:33",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372804",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372805,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-11 16:59:28",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372805",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372806,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-11 16:59:28",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372806",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372807,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-07 16:29:26",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372807",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372808,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-07 16:29:33",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372808",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372809,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-11 16:59:22",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372809",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372811,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-11 16:59:17",
          "facetId": 11,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372811",
          "type": "leaf",
          "flag": "fragment"
      }],
      "childrenNumber": 20,
      "type": "branch",
      "containChildrenFacet": false
  }, {
      "facetId": 12,
      "facetName": "基本术语",
      "facetLayer": 1,
      "parentFacetId": null,
      "topicId": 2,
      "children": [{
          "facetId": 21,
          "facetName": "子图",
          "facetLayer": 2,
          "parentFacetId": 12,
          "topicId": 2,
          "children": [{
              "assembleId": 2848333,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-08 15:42:21",
              "facetId": 21,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848333",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372764,
              "assembleContent": "",
              "assembleScratchTime": "2018-07-11 17:01:04",
              "facetId": 21,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372764",
              "type": "leaf",
              "flag": "fragment"
          }],
          "childrenNumber": 2,
          "type": "branch",
          "containChildrenFacet": false
      }, {
          "facetId": 22,
          "facetName": "路径",
          "facetLayer": 2,
          "parentFacetId": 12,
          "topicId": 2,
          "children": [{
              "assembleId": 2848642,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-15 18:22:59",
              "facetId": 22,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848642",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372763,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-08 15:42:58",
              "facetId": 22,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372763",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372848,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-08 15:43:07",
              "facetId": 22,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372848",
              "type": "leaf",
              "flag": "fragment"
          }],
          "childrenNumber": 3,
          "type": "branch",
          "containChildrenFacet": false
      }, {
          "facetId": 23,
          "facetName": "树",
          "facetLayer": 2,
          "parentFacetId": 12,
          "topicId": 2,
          "children": [{
              "assembleId": 2848337,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-09 14:24:45",
              "facetId": 23,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848337",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2848643,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-15 18:23:11",
              "facetId": 23,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848643",
              "type": "leaf",
              "flag": "fragment"
          }],
          "childrenNumber": 2,
          "type": "branch",
          "containChildrenFacet": false
      }, {
          "facetId": 24,
          "facetName": "团",
          "facetLayer": 2,
          "parentFacetId": 12,
          "topicId": 2,
          "children": [{
              "assembleId": 2848338,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-09 14:25:20",
              "facetId": 24,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848338",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2848644,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-15 18:23:47",
              "facetId": 24,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848644",
              "type": "leaf",
              "flag": "fragment"
          }],
          "childrenNumber": 2,
          "type": "branch",
          "containChildrenFacet": false
      }],
      "childrenNumber": 4,
      "type": "branch",
      "containChildrenFacet": true
  }, {
      "facetId": 13,
      "facetName": "相邻与度数",
      "facetLayer": 1,
      "parentFacetId": null,
      "topicId": 2,
      "children": [{
          "facetId": 29,
          "facetName": "独立集",
          "facetLayer": 2,
          "parentFacetId": 13,
          "topicId": 2,
          "children": [{
              "assembleId": 2372850,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-07 16:37:16",
              "facetId": 29,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372850",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372852,
              "assembleContent": "",
              "assembleScratchTime": "2018-07-11 17:01:15",
              "facetId": 29,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372852",
              "type": "leaf",
              "flag": "fragment"
          }],
          "childrenNumber": 2,
          "type": "branch",
          "containChildrenFacet": false
      }],
      "childrenNumber": 1,
      "type": "branch",
      "containChildrenFacet": true
  }, {
      "facetId": 14,
      "facetName": "连通性",
      "facetLayer": 1,
      "parentFacetId": null,
      "topicId": 2,
      "children": [{
          "assembleId": 2372267,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-05 15:35:19",
          "facetId": 14,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372267",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372268,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-05 15:34:28",
          "facetId": 14,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372268",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372269,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-05 15:35:38",
          "facetId": 14,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372269",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372270,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-05 15:35:59",
          "facetId": 14,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372270",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2848339,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-09 14:26:16",
          "facetId": 14,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848339",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2848646,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-15 18:24:24",
          "facetId": 14,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848646",
          "type": "leaf",
          "flag": "fragment"
      }],
      "childrenNumber": 6,
      "type": "branch",
      "containChildrenFacet": false
  }, {
      "facetId": 15,
      "facetName": "距离",
      "facetLayer": 1,
      "parentFacetId": null,
      "topicId": 2,
      "children": [{
          "assembleId": 458794,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:42:12",
          "facetId": 15,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=458794",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 477297,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:47:23",
          "facetId": 15,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=477297",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372263,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-05 15:36:30",
          "facetId": 15,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372263",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372264,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-05 15:37:01",
          "facetId": 15,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372264",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372265,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-05 15:37:06",
          "facetId": 15,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372265",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2848647,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-15 18:24:48",
          "facetId": 15,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848647",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372780,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-07 16:33:21",
          "facetId": 15,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372780",
          "type": "leaf",
          "flag": "fragment"
      }],
      "childrenNumber": 7,
      "type": "branch",
      "containChildrenFacet": false
  }, {
      "facetId": 16,
      "facetName": "亏格",
      "facetLayer": 1,
      "parentFacetId": null,
      "topicId": 2,
      "children": [{
          "assembleId": 459067,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:42:21",
          "facetId": 16,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=459067",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 477312,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:47:23",
          "facetId": 16,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=477312",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2848340,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-09 14:27:30",
          "facetId": 16,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848340",
          "type": "leaf",
          "flag": "fragment"
      }],
      "childrenNumber": 3,
      "type": "branch",
      "containChildrenFacet": false
  }, {
      "facetId": 17,
      "facetName": "带权图与网络",
      "facetLayer": 1,
      "parentFacetId": null,
      "topicId": 2,
      "children": [{
          "assembleId": 459072,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:42:21",
          "facetId": 17,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=459072",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2848341,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-09 14:28:26",
          "facetId": 17,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848341",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 459117,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:42:22",
          "facetId": 17,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=459117",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 459123,
          "assembleContent": "",
          "assembleScratchTime": "2017-12-21 12:42:22",
          "facetId": 17,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=459123",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372271,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-05 15:36:09",
          "facetId": 17,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372271",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372272,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-05 15:36:18",
          "facetId": 17,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372272",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372772,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-11 17:00:43",
          "facetId": 17,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372772",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372773,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-07 16:34:21",
          "facetId": 17,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372773",
          "type": "leaf",
          "flag": "fragment"
      }],
      "childrenNumber": 8,
      "type": "branch",
      "containChildrenFacet": false
  }, {
      "facetId": 18,
      "facetName": "图的方向",
      "facetLayer": 1,
      "parentFacetId": null,
      "topicId": 2,
      "children": [{
          "facetId": 30,
          "facetName": "有向无环图",
          "facetLayer": 2,
          "parentFacetId": 18,
          "topicId": 2,
          "children": [{
              "assembleId": 488327,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-07 16:37:40",
              "facetId": 30,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=488327",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372484,
              "assembleContent": "",
              "assembleScratchTime": "2018-07-10 17:02:23",
              "facetId": 30,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372484",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372856,
              "assembleContent": "",
              "assembleScratchTime": "2018-07-11 17:01:23",
              "facetId": 30,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372856",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372857,
              "assembleContent": "",
              "assembleScratchTime": "2018-07-11 17:01:29",
              "facetId": 30,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372857",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372859,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-07 16:38:03",
              "facetId": 30,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372859",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372860,
              "assembleContent": "",
              "assembleScratchTime": "2018-07-11 17:01:34",
              "facetId": 30,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372860",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372861,
              "assembleContent": "",
              "assembleScratchTime": "2018-11-07 16:38:50",
              "facetId": 30,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372861",
              "type": "leaf",
              "flag": "fragment"
          }, {
              "assembleId": 2372863,
              "assembleContent": "",
              "assembleScratchTime": "2018-07-11 17:01:51",
              "facetId": 30,
              "sourceId": 0,
              "domainId": null,
              "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372863",
              "type": "leaf",
              "flag": "fragment"
          }],
          "childrenNumber": 8,
          "type": "branch",
          "containChildrenFacet": false
      }],
      "childrenNumber": 1,
      "type": "branch",
      "containChildrenFacet": true
  }, {
      "facetId": 19,
      "facetName": "图的着色",
      "facetLayer": 1,
      "parentFacetId": null,
      "topicId": 2,
      "children": [{
          "assembleId": 2848342,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-09 14:29:16",
          "facetId": 19,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848342",
          "type": "leaf",
          "flag": "fragment"
      }, {
          "assembleId": 2372765,
          "assembleContent": "",
          "assembleScratchTime": "2018-07-11 17:01:02",
          "facetId": 19,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2372765",
          "type": "leaf",
          "flag": "fragment"
      }],
      "childrenNumber": 2,
      "type": "branch",
      "containChildrenFacet": false
  }, {
      "facetId": 20,
      "facetName": "不变量",
      "facetLayer": 1,
      "parentFacetId": null,
      "topicId": 2,
      "children": [{
          "assembleId": 2848343,
          "assembleContent": "",
          "assembleScratchTime": "2018-11-09 14:29:50",
          "facetId": 20,
          "sourceId": 0,
          "domainId": null,
          "url": "47.95.145.72:8083/assemble/getAssembleContentById?assembleId=2848343",
          "type": "leaf",
          "flag": "fragment"
      }],
      "childrenNumber": 1,
      "type": "branch",
      "containChildrenFacet": false
  }],
  "childrenNumber": 10
};




let angles = [];
let xs = [];
let ys = [];
let minHeight = 0;
let Height = [400, 390, 380, 365, 350, 335, 320, 300, 280, 260, 240, 220, 200, 180];
let foldLength = [];
let branchLimits = 7;
let masks = [];
// 画布长宽
let canvasWidth = 240;
let canvasHeight = 350;
// 一级分面宽度
let firstLayerWidth = 16;

// 一级分面间隔
let firstLayerInterval = 4;

// 一级分面弯曲的初始角度
let initialAngle = 125;

// 一级分面之间角度差
let deltaAngle = 16;

// 1:Dust Red 2:Volcano 3:Sunset Orange 4:Calendula Cold 5:Sunrise Yellow 6:Lime 7:Polar Green 8:Cyan 9:Daybreak Blue 10:Geek Blue 11:Golden Purple 12:Magenta
// color = ["#D32731","#DA5526","#E18B29","#E7AC2F","#F1DA38","#B1D837","#7FC236","#6EC1C1","#548FFB","#3E55E7","#6431CC","#CB3392"]
let color = ['#B50010', '#E3A407', '#618FE3', '#E14773', '#547400', '#7C21FF', '#7F572B', '#7CC7C0'];
// 一级分面数量
let FirstLayerNum = 0;

function drawTree(data, canvas, multiple) {
  console.log(data);
  //console.log(canvas);
  // multiple
  let height = Height.map(h => h * multiple);

  d3.selectAll('g').remove();
  data = processData(data, height);
  FirstLayerNum = data.length;
  if (data.length > 7) {
    minHeight = height[height.length - 2];
  } else {
    minHeight = height[height.length - 1];
  }

  angles = [];
  xs = [];
  ys = [];
  foldLength = [];
  masks = [];
  for (let i = 0; i < data.length; i++) {
    if (data[i].children.length !== 0 && data[i].children[0].type === 'branch') {
      masks.push(1);
    } else {
      masks.push(0);
    }
  }

  let g = canvas.append('g')
    .selectAll('rect')
    .data(data)
    .enter()
    .append('rect')
    // 计算一级分枝左上角纵坐标
    .attr('y', function(d) {
      ys.push(canvasHeight - d.h);
      return canvasHeight - d.h;
    })
    // 计算一级分枝左上角横坐标
    .attr('x', function(d, i) {
      // 如果一级分枝数量是奇数
      if (FirstLayerNum % 2) {
        let x = canvasWidth / 2 - firstLayerWidth / 2 - (firstLayerInterval + firstLayerWidth) * (FirstLayerNum - 1) / 2 + (firstLayerInterval + firstLayerWidth) * i;
        xs.push(x);
        return x;
      }
      // 如果一级分枝数量是偶数
      else {
        let x = canvasWidth / 2 + firstLayerInterval / 2 - (firstLayerWidth + firstLayerInterval) * FirstLayerNum / 2 + (firstLayerInterval + firstLayerWidth) * i;
        xs.push(x);
        return x;
      }
    })
    .attr('height', function(d) {
      return d.h;
    })
    .attr('width', firstLayerWidth)
    // 各分枝颜色
    .attr('fill', function(d, i) {
      return color[i];
    });

  // 画一级分枝弯折部分
  let g1 = canvas.append('g')
    .selectAll('rect')
    .data(data)
    .enter()
    .append('rect')
    .attr('y', function(d) {
      return canvasHeight - d.h;
    })
    .attr('x', function(d, i) {
      // return i*30;
      if (FirstLayerNum % 2) {
        let x = canvasWidth / 2 - firstLayerWidth / 2 - (firstLayerInterval + firstLayerWidth) * (FirstLayerNum - 1) / 2 + (firstLayerInterval + firstLayerWidth) * i;
        if (x === canvasWidth / 2 - firstLayerWidth / 2) {
          return x;
        }
        else if (x < canvasWidth / 2) {
          return x + firstLayerWidth;
        }
        else {
          return x - firstLayerWidth;
        }
      }
      else {
        let x = canvasWidth / 2 + firstLayerInterval / 2 - (firstLayerWidth + firstLayerInterval) * FirstLayerNum / 2 + (firstLayerInterval + firstLayerWidth) * i;
        if (x < canvasWidth / 2) {
          return x + firstLayerWidth;
        }
        else {
          return x - firstLayerWidth;
        }
      }
    })
    .attr('height', function(d, i) {
      if (masks[i] === 0) {
        if (FirstLayerNum === 1) {
          foldLength.push(d.h / 3);
          return d.h / 4;
        }
        foldLength.push(d.h / 4);
        return d.h / 4;
      } else {
        if (FirstLayerNum === 1) {
          foldLength.push(d.h / 3 + 10);
          return d.h / 4;
        }
        foldLength.push(d.h / 4 + 10);
        return d.h / 4;
      }
    })
    .attr('width', firstLayerWidth)
    .attr('fill', function(d, i) {
      return color[i];
    })
    .attr('transform', function(d, i) {
      let y = canvasHeight - d.h;
      if (FirstLayerNum % 2) {
        let x = canvasWidth / 2 - firstLayerWidth / 2 - (firstLayerInterval + firstLayerWidth) * (FirstLayerNum - 1) / 2 + (firstLayerInterval + firstLayerWidth) * i;
        if (x === canvasWidth / 2 - firstLayerWidth / 2) {
          angles.push(180);
          return 'rotate(180 ' + canvasWidth / 2 + ',' + y + ')';
        }
        else if (x < canvasWidth / 2) {
          angles.push(initialAngle + deltaAngle * i);
          return 'rotate(' + (initialAngle + deltaAngle * i) + ' ' + (x + firstLayerWidth) + ',' + y + ')';
        }
        else {
          angles.push(-initialAngle - deltaAngle * (FirstLayerNum - i - 1));
          return 'rotate(' + (-initialAngle - deltaAngle * (FirstLayerNum - i - 1)) + ' ' + x + ',' + y + ')';
        }
      }
      else {
        let x = canvasWidth / 2 + firstLayerInterval / 2 - (firstLayerWidth + firstLayerInterval) * FirstLayerNum / 2 + (firstLayerInterval + firstLayerWidth) * i;
        if (x < canvasWidth / 2) {
          angles.push(initialAngle + deltaAngle * i);
          return 'rotate(' + (initialAngle + deltaAngle * i) + ' ' + (x + firstLayerWidth) + ',' + y + ')';
        }
        else {
          angles.push(-initialAngle - deltaAngle * (FirstLayerNum - i - 1));
          return 'rotate(' + (-initialAngle - deltaAngle * (FirstLayerNum - i - 1)) + ' ' + x + ',' + y + ')';
        }
      }
    });
   
  let texts = canvas.append('g')
    .selectAll('text')
    .data(data)
    .enter()
    .append('text')
    .attr('font-size', '14px')
    .attr('y', function(d) {
      return canvasHeight - d.h;
    })
    .attr('x', function(d, i) {
      return xs[i];
    })
    .attr('fill', 'white');
    console.log(texts)
  for (let i = 0; i < FirstLayerNum; i++) {
    d3.select(texts._groups[0][i])
      .selectAll('tspan')
      .data(data[i].facetName.split(''))
      .enter()
      .append('tspan')
      .attr('x', xs[i] + (firstLayerWidth - 14) / 2)
      .attr('dy', '1.2em')
      .text(function(d) {
        return d;
      });
  }

  let circles = canvas.append('g')
    .selectAll('circle')
    .data(data)
    .enter()
    .append('circle')
    .attr('cx', function(d, i) {
      data[i].cx = xs[i] + firstLayerWidth / 2 + Math.cos(Math.PI * (270 - angles[i]) / 180) * foldLength[i] * 1.5;
      return data[i].cx;
    })
    .attr('cy', function(d, i) {
      data[i].cy = ys[i] - Math.sin(Math.PI * (270 - angles[i]) / 180) * foldLength[i] * 1.5;
      return data[i].cy;
    })
    .attr('r', 16)
    .attr('fill', function(d, i) {
      return color[i];
    })
    .on('click', function(d) {
      
      // if (d.facetId === -1) return;
      // appState.setCurrentPage(0);
      // appState.setCurrentFacet(d.facetName, '', d.facetId, -1);
    });

  masks.forEach((element, i) => {
    if (element === 1 && data[i].children.length < 6) {
      d3.select(circles._groups[0][i]).remove();
      let d = data[i];
      let nodes = [];
      let links = [];
      d.children.forEach(element => {
        element.id = element.facetName;
        element.parentFacetName = data[i].facetName;
        nodes.push(element);
      });
      for (let n = 0; n < nodes.length - 1; n++) {
        links.push({
          'source': nodes[n].id,
          'target': nodes[n + 1].id,
          value: 10
        });
      }
      links.push({
        'source': nodes[nodes.length - 1].id,
        'target': nodes[0].id,
        value: 10
      });

      let fcy = d.cy;
      let index = i;
      let simulation = d3.forceSimulation(nodes, links, d.cx, d.cy);

      let secondTexts = canvas.append('g')
        .selectAll('text')
        .data(nodes)
        .enter()
        .append('text')
        .attr('fill', color[index])
        .text(function(d) {
          return d.facetName;
        });


      let link = canvas.append('g').attr('id', 'links')
        .attr('stroke', '#999')
        .attr('stroke-opacity', 0.6)
        .selectAll('line')
        .data(links)
        .enter().append('line')
        .attr('stroke-width', d => Math.sqrt(d.value));

      let node = canvas.append('g').attr('id', 'nodes')
        .attr('stroke', '#fff')
        .attr('stroke-width', 1.5)
        .selectAll('circle')
        .data(nodes)
        .enter().append('circle')
        .attr('r', 9)
        .attr('fill', color[i])
        .on('click', (d) => {
         // console.log(d+11);
          // if (d.parentFacetId === null) {
          //   appState.setCurrentPage(0);
          //   appState.setCurrentFacet(d.facetName, '', d.facetId, -1);
          // } else {
          //   appState.setCurrentPage(0);
          //   appState.setCurrentFacet(
          //     d.parentFacetName,
          //     d.facetName,
          //     d.parentFacetId,
          //     d.facetId
          //   );
          // }

        })
        .call(d3.drag()
          .on('start', (d) => {
            if (!d3.event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
          })
          .on('drag', (d) => {
            d.fx = d3.event.x;
            d.fy = d3.event.y;
          })
          .on('end', (d) => {
            if (!d3.event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
          }));

      simulation.on('tick', () => {
        link
          .attr('x1', d => d.source.x)
          .attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x)
          .attr('y2', d => d.target.y);

        node
          .attr('cx', d => d.x)
          .attr('cy', d => d.y);


        secondTexts
          .attr('x', d => d.x + 15)
          .attr('y', d => {
            if (d.y > fcy) {
              return d.y + 15;
            } else {
              return d.y - 15;
            }
          });
      });
    }
  });
}

function processData(arr, height) {

  let branchWithSecondLayer = [];
  let branchWithoutSecondLayer = [];

  // 按有无二级分面对一级分面进行筛选
  arr.children.forEach((element) => {
    if (element.containChildrenFacet === true) {
      branchWithSecondLayer.push(element);
    } else {
      branchWithoutSecondLayer.push(element);
    }
  });
  // 没有二级分面的一级分面按二级分面下的碎片数量降序
  branchWithoutSecondLayer.sort(sortBranch);
  // 有二级分面的一级分面按二级分面数量降序
  branchWithSecondLayer.sort(sortBranch);
  // 对排序后的一级分面进行拼接
  let sortedBranch = branchWithSecondLayer.concat(branchWithoutSecondLayer);

  // 将降序的数组重排，权重大的在中间
  let resultBranch = [];
  if (sortedBranch.length < branchLimits + 1) {
    for (let i = 0; i < sortedBranch.length; i += 2) {
      if (i < sortedBranch.length) {
        sortedBranch[i].h = height[height.length + i - sortedBranch.length];
        resultBranch.unshift(sortedBranch[i]);
      }
      else {
        return resultBranch;
      }
      if (i + 1 < sortedBranch.length) {
        sortedBranch[i + 1].h = height[height.length + i - sortedBranch.length + 1];
        resultBranch.push(sortedBranch[i + 1]);
      }
      else {
        return resultBranch;
      }
    }
  }
  else {
    let combinedBranch = {
      children: [],
      containChildrenFacet: true,
      facetId: -1,
      facetName: '其他分面',
      h: height[height.length - 1],
      parentFacetId: null,
      topicId: null,
      type: 'branch'
    };
    for (let i = 0; i < branchLimits; i += 2) {
      if (i < branchLimits) {
        sortedBranch[i].h = height[height.length + i - branchLimits - 1];
        resultBranch.unshift(sortedBranch[i]);
      }
      else {
        break;
      }
      if (i + 1 < branchLimits) {
        sortedBranch[i + 1].h = height[height.length + i - branchLimits];
        resultBranch.push(sortedBranch[i + 1]);
      }
      else {
        break;
      }
    }
    for (let i = branchLimits; i < sortedBranch.length; i++) {
      combinedBranch.children.push(sortedBranch[i]);
    }
    resultBranch.push(combinedBranch);
  }
  return resultBranch;
}

function sortBranch(a, b) {
  return b.children.length - a.children.length;
}

function dragstarted(d, simulation) {
  console.log(d3.event);
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

function dragended(d, simulation) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

function forceSimulation(nodes, links, cx, cy) {
console.log(nodes);
  return d3.forceSimulation(nodes)
    .force('link', d3.forceLink(links).id(d => d.id))
    .force('link', d3.forceLink(links).distance(30))
    .force('charge', d3.forceManyBody())
    .force('center', d3.forceCenter(cx, cy));
}
let svg = d3.select('svg');
drawTree(data, svg, 0.6)
